import aiohttp
import json
import random
from database import get_setting

# –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∞—Ñ—Ñ–∏—Ä–º–∞—Ü–∏–π –Ω–∞ —Ä—É—Å—Å–∫–æ–º
AFFIRMATIONS_LIBRARY = [
    "–Ø –ø–æ–ª–Ω–∞ —ç–Ω–µ—Ä–≥–∏–∏ –∏ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏. –°–µ–≥–æ–¥–Ω—è –ø—Ä–µ–∫—Ä–∞—Å–Ω—ã–π –¥–µ–Ω—å –¥–ª—è –Ω–æ–≤—ã—Ö –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π.",
    "–Ø –¥–æ—Å—Ç–æ–π–Ω–∞ –ª—é–±–≤–∏, —É—Å–ø–µ—Ö–∞ –∏ —Å—á–∞—Å—Ç—å—è. –ú–æ—è –∂–∏–∑–Ω—å –Ω–∞–ø–æ–ª–Ω–µ–Ω–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏.",
    "–ö–∞–∂–¥—ã–π –¥–µ–Ω—å —è —Å—Ç–∞–Ω–æ–≤–ª—é—Å—å —Å–∏–ª—å–Ω–µ–µ –∏ –º—É–¥—Ä–µ–µ. –Ø —Å–æ–∑–¥–∞—é —Å–≤–æ—é —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å.",
    "–Ø –ø—Ä–∏–Ω–∏–º–∞—é —Å–µ–±—è –ø–æ–ª–Ω–æ—Å—Ç—å—é. –ú–æ—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å - –º–æ—è —Å–∏–ª–∞.",
    "–Ø –ø—Ä–∏–≤–ª–µ–∫–∞—é –≤ —Å–≤–æ—é –∂–∏–∑–Ω—å –ø–æ–∑–∏—Ç–∏–≤ –∏ –∏–∑–æ–±–∏–ª–∏–µ. –í—Å—ë –ø–æ–ª—É—á–∞–µ—Ç—Å—è –ª–µ–≥–∫–æ.",
    "–ú–æ—ë —Ç–µ–ª–æ –∑–¥–æ—Ä–æ–≤–æ, —Ä–∞–∑—É–º —Å–ø–æ–∫–æ–µ–Ω, –¥—É—à–∞ —Å—á–∞—Å—Ç–ª–∏–≤–∞. –Ø –≤ –≥–∞—Ä–º–æ–Ω–∏–∏ —Å —Å–æ–±–æ–π.",
    "–Ø –∑–∞—Å–ª—É–∂–∏–≤–∞—é —Å–∞–º–æ–≥–æ –ª—É—á—à–µ–≥–æ. –ñ–∏–∑–Ω—å –¥–∞—Ä–∏—Ç –º–Ω–µ —É–¥–∏–≤–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏.",
    "–Ø —Å–º–µ–ª–æ –∏–¥—É –∫ —Å–≤–æ–∏–º —Ü–µ–ª—è–º. –ü—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è –¥–µ–ª–∞—é—Ç –º–µ–Ω—è —Å–∏–ª—å–Ω–µ–µ.",
    "–Ø –∏–∑–ª—É—á–∞—é —Å–≤–µ—Ç –∏ —Ä–∞–¥–æ—Å—Ç—å. –ú–æ—è –ø–æ–∑–∏—Ç–∏–≤–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è –ø—Ä–∏—Ç—è–≥–∏–≤–∞–µ—Ç —É—Å–ø–µ—Ö.",
    "–Ø –±–ª–∞–≥–æ–¥–∞—Ä–Ω–∞ –∑–∞ –∫–∞–∂–¥—ã–π –Ω–æ–≤—ã–π –¥–µ–Ω—å. –ñ–∏–∑–Ω—å –ø–æ–ª–Ω–∞ —á—É–¥–µ—Å –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π.",
    "–ú–æ—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å–∏–ª–∞ –±–µ–∑–≥—Ä–∞–Ω–∏—á–Ω–∞. –Ø —Å–ø–æ—Å–æ–±–Ω–∞ –Ω–∞ –≤–µ–ª–∏–∫–∏–µ —Å–≤–µ—Ä—à–µ–Ω–∏—è.",
    "–Ø –ª—é–±–ª—é –∏ –ø—Ä–∏–Ω–∏–º–∞—é —Å–µ–±—è. –ú–æ–π –ø—É—Ç—å —É–Ω–∏–∫–∞–ª–µ–Ω –∏ –ø—Ä–µ–∫—Ä–∞—Å–µ–Ω.",
    "–ö–∞–∂–¥–æ–µ —É—Ç—Ä–æ - –Ω–æ–≤—ã–π —à–∞–Ω—Å —Å—Ç–∞—Ç—å –ª—É—á—à–µ. –Ø —Ä–∞—Å—Ç—É –∏ —Ä–∞–∑–≤–∏–≤–∞—é—Å—å.",
    "–Ø –≤–µ—Ä—é –≤ —Å–≤–æ–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏. –í—Å—ë –∑–∞–¥—É–º–∞–Ω–Ω–æ–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å–±—É–¥–µ—Ç—Å—è.",
    "–ú–æ—è –∂–∏–∑–Ω—å –Ω–∞–ø–æ–ª–Ω–µ–Ω–∞ —Å–º—ã—Å–ª–æ–º –∏ —Ä–∞–¥–æ—Å—Ç—å—é. –Ø –∂–∏–≤—É –≤ –º–æ–º–µ–Ω—Ç–µ.",
    "–Ø –æ–∫—Ä—É–∂–µ–Ω–∞ –ª—é–±–æ–≤—å—é –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π. –í—Å–µ–ª–µ–Ω–Ω–∞—è –∑–∞–±–æ—Ç–∏—Ç—Å—è –æ–±–æ –º–Ω–µ.",
    "–ú–æ–∏ –º–µ—á—Ç—ã –ø—Ä–µ–≤—Ä–∞—â–∞—é—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å. –Ø —Å–æ–∑–¥–∞—é –∂–∏–∑–Ω—å —Å–≤–æ–µ–π –º–µ—á—Ç—ã.",
    "–Ø —Å–ø–æ–∫–æ–π–Ω–∞ –∏ —É–≤–µ—Ä–µ–Ω–∞ –≤ —Å–µ–±–µ. –ú–æ—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –≥–∞—Ä–º–æ–Ω–∏—è –æ—Ç—Ä–∞–∂–∞–µ—Ç—Å—è –≤–æ–≤–Ω–µ.",
    "–ö–∞–∂–¥—ã–π –≤—ã–∑–æ–≤ - —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–æ—Å—Ç–∞. –Ø –ø—Ä–∏–Ω–∏–º–∞—é –∂–∏–∑–Ω—å —Å –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å—é.",
    "–Ø –∏–∑–ª—É—á–∞—é —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –∏ –ø–æ–∑–∏—Ç–∏–≤. –ú–æ—è —ç–Ω–µ—Ä–≥–∏—è –≤–¥–æ—Ö–Ω–æ–≤–ª—è–µ—Ç –æ–∫—Ä—É–∂–∞—é—â–∏—Ö.",
]

async def generate_affirmation():
    """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∞—Ñ—Ñ–∏—Ä–º–∞—Ü–∏–∏"""
    
    # –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–±—É–µ–º API
    try:
        prompt = get_setting('prompt')
        model = get_setting('model')
        
        payload = {
            "model": model,
            "prompt": prompt,
            "stream": False
        }
        
        async with aiohttp.ClientSession() as session:
            async with session.post("https://mlvoca.com/api/generate", json=payload, timeout=10) as response:
                if response.status == 200:
                    data = await response.json()
                    affirmation = data.get('response', '').strip()
                    if affirmation and len(affirmation) > 10:
                        print(f"‚úÖ API —É—Å–ø–µ—Ö: {affirmation}")
                        return affirmation
    except Exception as e:
        print(f"‚ö†Ô∏è  API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω: {e}")
    
    # –ï—Å–ª–∏ API –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª - –±–µ—Ä—ë–º –∏–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
    affirmation = random.choice(AFFIRMATIONS_LIBRARY)
    print(f"üìö –ò–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏: {affirmation}")
    return affirmation